<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title></title>
        <script src="compiler.js"></script>
    </head>
    <body>
        <script>
            function doCompileKeenNow() {
                function loadText(url, array, callback) {
                    var xmlhttp = new XMLHttpRequest();
                    xmlhttp.onreadystatechange = function() {
                        if (xmlhttp.readyState == XMLHttpRequest.DONE) {
                            if(xmlhttp.status == 200) {
                                array.push({_: "pair", first: url, second: xmlhttp.responseText});
                                callback(array);
                            } else {
                                console.error('AJAX error ' + xmlhttp.status);
                            }
                        }
                    };
                    xmlhttp.open("GET", url, true);
                    xmlhttp.send();
                }

                var moduleFiles = [
                    "compiler/ArrayBuilder.lim",
                    "compiler/Lexer.lim",
                    "compiler/Resolver.lim",
                    "compiler/StringMap.lim",
                    "compiler/CharCursor.lim",
                    "compiler/Pc.lim",
                    "compiler/StringBuilder.lim",
                    "compiler/Token.lim",
                    "compiler/Prelude.lim",
                    "compiler/Syntax.lim",
                    "compiler/TokenCursor.lim",
                    "compiler/Parser.lim",
                    "compiler/Typer.lim",
                    "compiler/Check.lim",
                    "compiler/Emit.lim"
                ];

                var moduleSources = [];

                function compile() {
                    if(moduleFiles.length != moduleSources.length) return;
                    var go = testAll;
                    testAll = null; // To ensure we won't call the same version of the compiler again
                    go(moduleSources);
                }

                for(var i = 0; i < moduleFiles.length; i++) loadText(moduleFiles[i], moduleSources, compile);
            }

            doCompileKeenNow();
        </script>
    </body>
</html>
